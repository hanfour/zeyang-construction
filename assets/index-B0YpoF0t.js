var Ve=a=>{throw TypeError(a)};var Re=(a,t,r)=>t.has(a)||Ve("Cannot "+r);var i=(a,t,r)=>(Re(a,t,"read from private field"),r?r.call(a):t.get(a)),M=(a,t,r)=>t.has(a)?Ve("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(a):t.set(a,r),F=(a,t,r,l)=>(Re(a,t,"write to private field"),l?l.call(a,r):t.set(a,r),r),L=(a,t,r)=>(Re(a,t,"access private method"),r);import{S as ct,p as We,m as K,s as Fe,o as ve,a as Ee,q as Ie,t as qe,v as dt,w as ut,x as mt,y as Ze,n as Xe,r as n,b as ht,u as pt,j as e,V as R,z as gt,A as ke,l as Le,B as xt,_ as he}from"./index-By57yhN3.js";import{p as T}from"./project.service-zsHHG8Aw.js";import{F as pe,a as ft}from"./TrashIcon-DAMfXNnH.js";import{g as Pe,a as bt}from"./image-CG6tEh5z.js";import{F as yt}from"./CheckCircleIcon-FQWdJK1s.js";import{t as vt}from"./tag.service-BaFTJMAM.js";import{F as wt}from"./EyeIcon-12aYC9kG.js";var A,y,we,$,le,ge,ae,re,je,xe,fe,oe,ce,ne,be,j,ye,Oe,De,Me,Te,Ue,$e,Qe,et,Je,jt=(Je=class extends ct{constructor(t,r){super();M(this,j);M(this,A);M(this,y);M(this,we);M(this,$);M(this,le);M(this,ge);M(this,ae);M(this,re);M(this,je);M(this,xe);M(this,fe);M(this,oe);M(this,ce);M(this,ne);M(this,be,new Set);this.options=r,F(this,A,t),F(this,re,null),F(this,ae,We()),this.options.experimental_prefetchInRender||i(this,ae).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(r)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(i(this,y).addObserver(this),Ge(i(this,y),this.options)?L(this,j,ye).call(this):this.updateResult(),L(this,j,Te).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return Be(i(this,y),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return Be(i(this,y),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,L(this,j,Ue).call(this),L(this,j,$e).call(this),i(this,y).removeObserver(this)}setOptions(t){const r=this.options,l=i(this,y);if(this.options=i(this,A).defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof K(this.options.enabled,i(this,y))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");L(this,j,Qe).call(this),i(this,y).setOptions(this.options),r._defaulted&&!Fe(this.options,r)&&i(this,A).getQueryCache().notify({type:"observerOptionsUpdated",query:i(this,y),observer:this});const f=this.hasListeners();f&&Ke(i(this,y),l,this.options,r)&&L(this,j,ye).call(this),this.updateResult(),f&&(i(this,y)!==l||K(this.options.enabled,i(this,y))!==K(r.enabled,i(this,y))||ve(this.options.staleTime,i(this,y))!==ve(r.staleTime,i(this,y)))&&L(this,j,Oe).call(this);const u=L(this,j,De).call(this);f&&(i(this,y)!==l||K(this.options.enabled,i(this,y))!==K(r.enabled,i(this,y))||u!==i(this,ne))&&L(this,j,Me).call(this,u)}getOptimisticResult(t){const r=i(this,A).getQueryCache().build(i(this,A),t),l=this.createResult(r,t);return kt(this,l)&&(F(this,$,l),F(this,ge,this.options),F(this,le,i(this,y).state)),l}getCurrentResult(){return i(this,$)}trackResult(t,r){return new Proxy(t,{get:(l,f)=>(this.trackProp(f),r==null||r(f),Reflect.get(l,f))})}trackProp(t){i(this,be).add(t)}getCurrentQuery(){return i(this,y)}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const r=i(this,A).defaultQueryOptions(t),l=i(this,A).getQueryCache().build(i(this,A),r);return l.fetch().then(()=>this.createResult(l,r))}fetch(t){return L(this,j,ye).call(this,{...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),i(this,$)))}createResult(t,r){var B;const l=i(this,y),f=this.options,u=i(this,$),g=i(this,le),k=i(this,ge),b=t!==l?t.state:i(this,we),{state:I}=t;let w={...I},Q=!1,x;if(r._optimisticResults){const D=this.hasListeners(),o=!D&&Ge(t,r),d=D&&Ke(t,l,r,f);(o||d)&&(w={...w,...mt(I.data,t.options)}),r._optimisticResults==="isRestoring"&&(w.fetchStatus="idle")}let{error:z,errorUpdatedAt:q,status:E}=w;x=w.data;let Z=!1;if(r.placeholderData!==void 0&&x===void 0&&E==="pending"){let D;u!=null&&u.isPlaceholderData&&r.placeholderData===(k==null?void 0:k.placeholderData)?(D=u.data,Z=!0):D=typeof r.placeholderData=="function"?r.placeholderData((B=i(this,fe))==null?void 0:B.state.data,i(this,fe)):r.placeholderData,D!==void 0&&(E="success",x=Ze(u==null?void 0:u.data,D,r),Q=!0)}if(r.select&&x!==void 0&&!Z)if(u&&x===(g==null?void 0:g.data)&&r.select===i(this,je))x=i(this,xe);else try{F(this,je,r.select),x=r.select(x),x=Ze(u==null?void 0:u.data,x,r),F(this,xe,x),F(this,re,null)}catch(D){F(this,re,D)}i(this,re)&&(z=i(this,re),x=i(this,xe),q=Date.now(),E="error");const Y=w.fetchStatus==="fetching",J=E==="pending",X=E==="error",H=J&&Y,P=x!==void 0,S={status:E,fetchStatus:w.fetchStatus,isPending:J,isSuccess:E==="success",isError:X,isInitialLoading:H,isLoading:H,data:x,dataUpdatedAt:w.dataUpdatedAt,error:z,errorUpdatedAt:q,failureCount:w.fetchFailureCount,failureReason:w.fetchFailureReason,errorUpdateCount:w.errorUpdateCount,isFetched:w.dataUpdateCount>0||w.errorUpdateCount>0,isFetchedAfterMount:w.dataUpdateCount>b.dataUpdateCount||w.errorUpdateCount>b.errorUpdateCount,isFetching:Y,isRefetching:Y&&!J,isLoadingError:X&&!P,isPaused:w.fetchStatus==="paused",isPlaceholderData:Q,isRefetchError:X&&P,isStale:Ae(t,r),refetch:this.refetch,promise:i(this,ae),isEnabled:K(r.enabled,t)!==!1};if(this.options.experimental_prefetchInRender){const D=N=>{S.status==="error"?N.reject(S.error):S.data!==void 0&&N.resolve(S.data)},o=()=>{const N=F(this,ae,S.promise=We());D(N)},d=i(this,ae);switch(d.status){case"pending":t.queryHash===l.queryHash&&D(d);break;case"fulfilled":(S.status==="error"||S.data!==d.value)&&o();break;case"rejected":(S.status!=="error"||S.error!==d.reason)&&o();break}}return S}updateResult(){const t=i(this,$),r=this.createResult(i(this,y),this.options);if(F(this,le,i(this,y).state),F(this,ge,this.options),i(this,le).data!==void 0&&F(this,fe,i(this,y)),Fe(r,t))return;F(this,$,r);const l=()=>{if(!t)return!0;const{notifyOnChangeProps:f}=this.options,u=typeof f=="function"?f():f;if(u==="all"||!u&&!i(this,be).size)return!0;const g=new Set(u??i(this,be));return this.options.throwOnError&&g.add("error"),Object.keys(i(this,$)).some(k=>{const p=k;return i(this,$)[p]!==t[p]&&g.has(p)})};L(this,j,et).call(this,{listeners:l()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&L(this,j,Te).call(this)}},A=new WeakMap,y=new WeakMap,we=new WeakMap,$=new WeakMap,le=new WeakMap,ge=new WeakMap,ae=new WeakMap,re=new WeakMap,je=new WeakMap,xe=new WeakMap,fe=new WeakMap,oe=new WeakMap,ce=new WeakMap,ne=new WeakMap,be=new WeakMap,j=new WeakSet,ye=function(t){L(this,j,Qe).call(this);let r=i(this,y).fetch(this.options,t);return t!=null&&t.throwOnError||(r=r.catch(Ee)),r},Oe=function(){L(this,j,Ue).call(this);const t=ve(this.options.staleTime,i(this,y));if(Ie||i(this,$).isStale||!qe(t))return;const l=dt(i(this,$).dataUpdatedAt,t)+1;F(this,oe,setTimeout(()=>{i(this,$).isStale||this.updateResult()},l))},De=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(i(this,y)):this.options.refetchInterval)??!1},Me=function(t){L(this,j,$e).call(this),F(this,ne,t),!(Ie||K(this.options.enabled,i(this,y))===!1||!qe(i(this,ne))||i(this,ne)===0)&&F(this,ce,setInterval(()=>{(this.options.refetchIntervalInBackground||ut.isFocused())&&L(this,j,ye).call(this)},i(this,ne)))},Te=function(){L(this,j,Oe).call(this),L(this,j,Me).call(this,L(this,j,De).call(this))},Ue=function(){i(this,oe)&&(clearTimeout(i(this,oe)),F(this,oe,void 0))},$e=function(){i(this,ce)&&(clearInterval(i(this,ce)),F(this,ce,void 0))},Qe=function(){const t=i(this,A).getQueryCache().build(i(this,A),this.options);if(t===i(this,y))return;const r=i(this,y);F(this,y,t),F(this,we,t.state),this.hasListeners()&&(r==null||r.removeObserver(this),t.addObserver(this))},et=function(t){Xe.batch(()=>{t.listeners&&this.listeners.forEach(r=>{r(i(this,$))}),i(this,A).getQueryCache().notify({query:i(this,y),type:"observerResultsUpdated"})})},Je);function Nt(a,t){return K(t.enabled,a)!==!1&&a.state.data===void 0&&!(a.state.status==="error"&&t.retryOnMount===!1)}function Ge(a,t){return Nt(a,t)||a.state.data!==void 0&&Be(a,t,t.refetchOnMount)}function Be(a,t,r){if(K(t.enabled,a)!==!1&&ve(t.staleTime,a)!=="static"){const l=typeof r=="function"?r(a):r;return l==="always"||l!==!1&&Ae(a,t)}return!1}function Ke(a,t,r,l){return(a!==t||K(l.enabled,a)===!1)&&(!r.suspense||a.state.status!=="error")&&Ae(a,r)}function Ae(a,t){return K(t.enabled,a)!==!1&&a.isStaleByTime(ve(t.staleTime,a))}function kt(a,t){return!Fe(a.getCurrentResult(),t)}var tt=n.createContext(!1),_t=()=>n.useContext(tt);tt.Provider;function Ct(){let a=!1;return{clearReset:()=>{a=!1},reset:()=>{a=!0},isReset:()=>a}}var Rt=n.createContext(Ct()),St=()=>n.useContext(Rt),Ft=(a,t)=>{(a.suspense||a.throwOnError||a.experimental_prefetchInRender)&&(t.isReset()||(a.retryOnMount=!1))},Et=a=>{n.useEffect(()=>{a.clearReset()},[a])},It=({result:a,errorResetBoundary:t,throwOnError:r,query:l,suspense:f})=>a.isError&&!t.isReset()&&!a.isFetching&&l&&(f&&a.data===void 0||ht(r,[a.error,l])),Lt=a=>{if(a.suspense){const t=l=>l==="static"?l:Math.max(l??1e3,1e3),r=a.staleTime;a.staleTime=typeof r=="function"?(...l)=>t(r(...l)):t(r),typeof a.gcTime=="number"&&(a.gcTime=Math.max(a.gcTime,1e3))}},Pt=(a,t)=>a.isLoading&&a.isFetching&&!t,Ot=(a,t)=>(a==null?void 0:a.suspense)&&t.isPending,Ye=(a,t,r)=>t.fetchOptimistic(a).catch(()=>{r.clearReset()});function Dt(a,t,r){var w,Q,x,z,q;const l=_t(),f=St(),u=pt(),g=u.defaultQueryOptions(a);(Q=(w=u.getDefaultOptions().queries)==null?void 0:w._experimental_beforeQuery)==null||Q.call(w,g),g._optimisticResults=l?"isRestoring":"optimistic",Lt(g),Ft(g,f),Et(f);const k=!u.getQueryCache().get(g.queryHash),[p]=n.useState(()=>new t(u,g)),b=p.getOptimisticResult(g),I=!l&&a.subscribed!==!1;if(n.useSyncExternalStore(n.useCallback(E=>{const Z=I?p.subscribe(Xe.batchCalls(E)):Ee;return p.updateResult(),Z},[p,I]),()=>p.getCurrentResult(),()=>p.getCurrentResult()),n.useEffect(()=>{p.setOptions(g)},[g,p]),Ot(g,b))throw Ye(g,p,f);if(It({result:b,errorResetBoundary:f,throwOnError:g.throwOnError,query:u.getQueryCache().get(g.queryHash),suspense:g.suspense}))throw b.error;if((z=(x=u.getDefaultOptions().queries)==null?void 0:x._experimental_afterQuery)==null||z.call(x,g,b),g.experimental_prefetchInRender&&!Ie&&Pt(b,l)){const E=k?Ye(g,p,f):(q=u.getQueryCache().get(g.queryHash))==null?void 0:q.promise;E==null||E.catch(Ee).finally(()=>{p.updateResult()})}return g.notifyOnChangeProps?b:p.trackResult(b)}function Mt(a,t){return Dt(a,jt)}function Tt({title:a,titleId:t,...r},l){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:l,"aria-labelledby":t},r),a?n.createElement("title",{id:t},a):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 7.5 7.5 3m0 0L12 7.5M7.5 3v13.5m13.5 0L16.5 21m0 0L12 16.5m4.5 4.5V7.5"}))}const Ut=n.forwardRef(Tt);function $t({title:a,titleId:t,...r},l){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:l,"aria-labelledby":t},r),a?n.createElement("title",{id:t},a):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 16.5V9.75m0 0 3 3m-3-3-3 3M6.75 19.5a4.5 4.5 0 0 1-1.41-8.775 5.25 5.25 0 0 1 10.233-2.33 3 3 0 0 1 3.758 3.848A3.752 3.752 0 0 1 18 19.5H6.75Z"}))}const st=n.forwardRef($t);function Qt({title:a,titleId:t,...r},l){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:l,"aria-labelledby":t},r),a?n.createElement("title",{id:t},a):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L6.832 19.82a4.5 4.5 0 0 1-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 0 1 1.13-1.897L16.863 4.487Zm0 0L19.5 7.125"}))}const Bt=n.forwardRef(Qt);function At({title:a,titleId:t,...r},l){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:l,"aria-labelledby":t},r),a?n.createElement("title",{id:t},a):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 0 0 1.5-1.5V6a1.5 1.5 0 0 0-1.5-1.5H3.75A1.5 1.5 0 0 0 2.25 6v12a1.5 1.5 0 0 0 1.5 1.5Zm10.5-11.25h.008v.008h-.008V8.25Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z"}))}const _e=n.forwardRef(At);function zt({title:a,titleId:t,...r},l){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:l,"aria-labelledby":t},r),a?n.createElement("title",{id:t},a):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"}))}const ze=n.forwardRef(zt);function Ht({title:a,titleId:t,...r},l){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:l,"aria-labelledby":t},r),a?n.createElement("title",{id:t},a):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11.48 3.499a.562.562 0 0 1 1.04 0l2.125 5.111a.563.563 0 0 0 .475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 0 0-.182.557l1.285 5.385a.562.562 0 0 1-.84.61l-4.725-2.885a.562.562 0 0 0-.586 0L6.982 20.54a.562.562 0 0 1-.84-.61l1.285-5.386a.562.562 0 0 0-.182-.557l-4.204-3.602a.562.562 0 0 1 .321-.988l5.518-.442a.563.563 0 0 0 .475-.345L11.48 3.5Z"}))}const Se=n.forwardRef(Ht);function Vt({title:a,titleId:t,...r},l){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:l,"aria-labelledby":t},r),a?n.createElement("title",{id:t},a):null,n.createElement("path",{fillRule:"evenodd",d:"M10.788 3.21c.448-1.077 1.976-1.077 2.424 0l2.082 5.006 5.404.434c1.164.093 1.636 1.545.749 2.305l-4.117 3.527 1.257 5.273c.271 1.136-.964 2.033-1.96 1.425L12 18.354 7.373 21.18c-.996.608-2.231-.29-1.96-1.425l1.257-5.273-4.117-3.527c-.887-.76-.415-2.212.749-2.305l5.404-.434 2.082-5.005Z",clipRule:"evenodd"}))}const Ce=n.forwardRef(Vt);function Wt({title:a,titleId:t,...r},l){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:l,"aria-labelledby":t},r),a?n.createElement("title",{id:t},a):null,n.createElement("path",{fillRule:"evenodd",d:"M5.47 5.47a.75.75 0 0 1 1.06 0L12 10.94l5.47-5.47a.75.75 0 1 1 1.06 1.06L13.06 12l5.47 5.47a.75.75 0 1 1-1.06 1.06L12 13.06l-5.47 5.47a.75.75 0 0 1-1.06-1.06L10.94 12 5.47 6.53a.75.75 0 0 1 0-1.06Z",clipRule:"evenodd"}))}const qt=n.forwardRef(Wt),Zt=({fields:a,onChange:t,label:r="自訂欄位",placeholder:l={label:"欄位名稱",value:"欄位內容"}})=>{const f=()=>{const k={id:Date.now().toString(),label:"",value:""};t([...a,k])},u=k=>{t(a.filter(p=>p.id!==k))},g=(k,p,b)=>{t(a.map(I=>I.id===k?{...I,[p]:b}:I))};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:r}),e.jsxs("button",{type:"button",onClick:f,className:"inline-flex items-center px-3 py-1 border border-transparent text-sm leading-4 font-medium rounded-md text-primary-700 bg-primary-100 hover:bg-primary-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",children:[e.jsx(ze,{className:"h-4 w-4 mr-1"}),"新增欄位"]})]}),e.jsxs("div",{className:"space-y-3",children:[a.map(k=>e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{type:"text",value:k.label,onChange:p=>g(k.id,"label",p.target.value),placeholder:l.label,className:"flex-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary-500 focus:border-primary-500 sm:text-sm"}),e.jsx("input",{type:"text",value:k.value,onChange:p=>g(k.id,"value",p.target.value),placeholder:l.value,className:"flex-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary-500 focus:border-primary-500 sm:text-sm"}),e.jsx("button",{type:"button",onClick:()=>u(k.id),className:"inline-flex items-center p-2 border border-transparent rounded-md text-red-600 hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:e.jsx(pe,{className:"h-5 w-5"})})]},k.id)),a.length===0&&e.jsxs("div",{className:"text-center py-6 bg-gray-50 rounded-md",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"尚未新增任何自訂欄位"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"點擊上方按鈕開始新增"})]})]})]})},Gt=({projectUuid:a,images:t=[],onImagesChange:r,imageType:l="gallery",maxFiles:f=10})=>{const[u,g]=n.useState(!1),[k,p]=n.useState(0),[b,I]=n.useState([]),[w,Q]=n.useState(null),[x,z]=n.useState([]);n.useEffect(()=>()=>{x.forEach(o=>URL.revokeObjectURL(o.preview))},[x]);const q=n.useCallback(o=>{const d=Array.from(o.target.files||[]);if(d.length+t.length>f){R.error(`最多只能上傳 ${f} 張圖片`);return}const N=d.map(V=>({file:V,preview:URL.createObjectURL(V)}));z(V=>[...V,...N])},[t.length,f]),E=n.useCallback(o=>{z(d=>{const N=[...d];return URL.revokeObjectURL(N[o].preview),N.splice(o,1),N})},[]),Z=n.useCallback(async()=>{var o,d,N;if(!(!a||x.length===0)){g(!0),p(0);try{const V=x.map(ee=>ee.file),U=await T.uploadImages(a,V,l,void 0,ee=>p(ee));if(U.success&&U.data){const ee=((o=U.data.uploaded)==null?void 0:o.length)||0,te=((d=U.data.failed)==null?void 0:d.length)||0;ee>0&&R.success(`成功上傳 ${ee} 張圖片`),x.forEach(G=>URL.revokeObjectURL(G.preview)),z([]);const _=await T.getProject(a);_.success&&((N=_.data)!=null&&N.project.images)&&r(_.data.project.images),te>0&&R.error(`${te} 張圖片上傳失敗`)}}catch(V){R.error("圖片上傳失敗"),console.error("Upload error:",V)}finally{g(!1),p(0)}}},[a,x,l,t,r]),Y=n.useCallback(async o=>{if(a)try{await T.deleteImage(a,o),R.success("圖片已刪除"),r(t.filter(d=>d.id!==o)),I(d=>d.filter(N=>N!==o))}catch{R.error("刪除圖片失敗")}},[a,t,r]),J=n.useCallback(async o=>{if(a)try{await T.setMainImage(a,o),R.success("已設為主圖");const d=t.map(N=>({...N,image_type:N.id===o?"main":N.image_type==="main"?"gallery":N.image_type}));r(d)}catch{R.error("設定主圖失敗")}},[a,t,r]),X=(o,d)=>{Q(d),o.dataTransfer.effectAllowed="move"},H=o=>{o.preventDefault(),o.dataTransfer.dropEffect="move"},P=async(o,d)=>{if(o.preventDefault(),!w||w===d||!a)return;const N=t.findIndex(_=>_.id===w),V=t.findIndex(_=>_.id===d);if(N===-1||V===-1)return;const U=[...t],[ee]=U.splice(N,1);U.splice(V,0,ee);const te=U.map((_,G)=>({id:_.id,display_order:G}));try{await T.reorderImages(a,te),r(U.map((_,G)=>({..._,display_order:G}))),R.success("圖片順序已更新")}catch{R.error("更新順序失敗")}Q(null)},v=o=>{I(d=>d.includes(o)?d.filter(N=>N!==o):[...d,o])},S=async()=>{if(!(b.length===0||!a)&&confirm(`確定要刪除 ${b.length} 張圖片嗎？`))try{await Promise.all(b.map(o=>T.deleteImage(a,o))),R.success(`已刪除 ${b.length} 張圖片`),r(t.filter(o=>!b.includes(o.id))),I([])}catch{R.error("刪除圖片失敗")}},B=t.find(o=>o.image_type==="main"),D=t.filter(o=>o.image_type!=="main");return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx(st,{className:"mx-auto h-10 w-10 text-gray-400"}),e.jsxs("div",{className:"mt-3",children:[e.jsxs("label",{htmlFor:"file-upload",className:"cursor-pointer",children:[e.jsx("span",{className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700",children:"選擇圖片"}),e.jsx("input",{id:"file-upload",type:"file",className:"sr-only",multiple:!0,accept:"image/*",onChange:q,disabled:u})]}),e.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:["支援 JPG、PNG、GIF、WebP 格式，最多 ",f," 張"]})]})]}),x.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"grid grid-cols-2 gap-4 sm:grid-cols-3 lg:grid-cols-4",children:x.map((o,d)=>e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:o.preview,alt:`Preview ${d+1}`,className:"h-32 w-full object-scale-down rounded-lg border border-gray-100"}),e.jsx("button",{type:"button",onClick:()=>E(d),className:"absolute top-1 right-1 p-1 bg-red-600 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(gt,{className:"h-4 w-4"})})]},d))}),e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:["已設定 ",x.length," 張圖片"]}),e.jsx("button",{type:"button",onClick:Z,disabled:u||!a,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 disabled:opacity-50 disabled:cursor-not-allowed",children:u?"上傳中...":"開始上傳"})]}),u&&e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"bg-primary-600 h-2 transition-all duration-300",style:{width:`${k}%`}})}),e.jsxs("p",{className:"mt-1 text-sm text-gray-500 text-center",children:[k,"%"]})]})]})]}),t.length>0&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center space-x-2",children:b.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-sm text-gray-500",children:["已選擇 ",b.length," 張"]}),e.jsxs("button",{type:"button",onClick:S,className:"inline-flex items-center px-3 py-1 border border-transparent text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700",children:[e.jsx(pe,{className:"h-4 w-4 mr-1"}),"刪除選中"]})]})}),e.jsxs("p",{className:"text-sm text-gray-500",children:["共 ",t.length," 張圖片"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[B&&e.jsxs("div",{className:"mb-6 md:mb-0",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"主圖"}),e.jsxs("div",{className:"relative group bg-slate-50 overflow-hidden",children:[e.jsx("img",{src:Pe(B.file_path),alt:B.alt_text||"主圖",className:"w-full aspect-square object-scale-down rounded-lg"}),e.jsx("div",{className:"absolute top-2 left-2",children:e.jsxs("span",{className:"inline-flex items-center px-2 py-1 text-xs font-medium rounded-md bg-yellow-100 text-yellow-800",children:[e.jsx(Ce,{className:"h-3 w-3 mr-1"}),"主圖"]})})]})]}),D.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"相簿圖片"}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:D.map(o=>e.jsxs("div",{className:ke("relative group",b.includes(o.id)&&"ring-2 ring-primary-500 rounded-lg"),draggable:!0,onDragStart:d=>X(d,o.id),onDragOver:H,onDrop:d=>P(d,o.id),children:[e.jsx("img",{src:bt(o),alt:o.alt_text||`圖片 ${o.id}`,className:"h-32 w-full object-scale-down rounded-lg cursor-move border border-gray-100",onClick:()=>v(o.id)}),b.includes(o.id)&&e.jsx("div",{className:"absolute top-2 left-2",children:e.jsx(yt,{className:"h-6 w-6 text-primary-500 bg-white rounded-full"})}),e.jsxs("div",{className:"absolute inset-0 bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg flex items-center justify-center space-x-2",children:[e.jsx("button",{type:"button",onClick:d=>{d.stopPropagation(),J(o.id)},className:"p-2 bg-white rounded-full text-gray-700 hover:bg-gray-100",title:"設為主圖",children:e.jsx(Ce,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:d=>{d.stopPropagation(),Y(o.id)},className:"p-2 bg-white rounded-full text-red-600 hover:bg-red-50",title:"刪除",children:e.jsx(pe,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"absolute bottom-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(Ut,{className:"h-4 w-4 text-white"})})]},o.id))})]})]}),t.length===0&&x.length===0&&e.jsxs("div",{className:"text-center py-4",children:[e.jsx(_e,{className:"mx-auto h-10 w-10 text-gray-400"}),e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"尚未上傳任何圖片"})]})]})},Kt=({value:a=[],onChange:t,placeholder:r="輸入標籤名稱或選擇現有標籤",className:l="",disabled:f=!1})=>{var P;const[u,g]=n.useState(""),[k,p]=n.useState(!1),[b,I]=n.useState(a),w=n.useRef(null),Q=n.useRef(null),{data:x,isLoading:z}=Mt({queryKey:["tags",u],queryFn:()=>vt.getTags({search:u}),enabled:k}),q=((P=x==null?void 0:x.data)==null?void 0:P.items)||[];n.useEffect(()=>{I(a)},[a]),n.useEffect(()=>{const v=S=>{Q.current&&!Q.current.contains(S.target)&&w.current&&!w.current.contains(S.target)&&p(!1)};return document.addEventListener("mousedown",v),()=>document.removeEventListener("mousedown",v)},[]);const E=v=>{const S=v.trim();if(S&&!b.includes(S)){const B=[...b,S];I(B),t(B),g(""),p(!1)}},Z=v=>{const S=b.filter(B=>B!==v);I(S),t(S)},Y=v=>{v.key==="Enter"?(v.preventDefault(),u.trim()&&E(u)):v.key==="Backspace"&&!u&&b.length>0&&Z(b[b.length-1])},J=v=>{E(v.name)},X=q.filter(v=>!b.includes(v.name)),H=u.trim()&&!q.some(v=>v.name.toLowerCase()===u.trim().toLowerCase());return e.jsxs("div",{className:`relative ${l}`,children:[e.jsxs("div",{className:"flex flex-wrap gap-2 p-3 border border-gray-300 rounded-lg focus-within:border-primary-500 focus-within:ring-1 focus-within:ring-primary-500",children:[b.map(v=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded-full",children:[v,!f&&e.jsx("button",{type:"button",onClick:()=>Z(v),className:"hover:text-gray-900 focus:outline-none",children:e.jsx(qt,{className:"h-3 w-3"})})]},v)),e.jsx("input",{ref:w,type:"text",value:u,onChange:v=>g(v.target.value),onFocus:()=>p(!0),onKeyDown:Y,placeholder:b.length===0?r:"",disabled:f,className:"flex-1 min-w-[200px] outline-none bg-transparent text-sm"})]}),k&&!f&&e.jsx("div",{ref:Q,className:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-auto",children:z?e.jsx("div",{className:"p-4 text-center",children:e.jsx(Le,{size:"small"})}):e.jsxs(e.Fragment,{children:[H&&e.jsxs("button",{type:"button",onClick:()=>E(u),className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-50 flex items-center gap-2 border-b",children:[e.jsx(ze,{className:"h-4 w-4 text-primary-600"}),e.jsxs("span",{children:["新增標籤 「",u,"」"]})]}),X.length>0?e.jsx("div",{className:"py-1",children:X.map(v=>e.jsxs("button",{type:"button",onClick:()=>J(v),className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-50 flex items-center justify-between",children:[e.jsx("span",{children:v.name}),v.usage_count>0&&e.jsxs("span",{className:"text-xs text-gray-500",children:["使用 ",v.usage_count," 次"]})]},v.id))}):!H&&u&&e.jsx("div",{className:"p-4 text-sm text-gray-500 text-center",children:"沒有找到相符的標籤"})]})})]})},ns=()=>{const[a,t]=xt(),[r,l]=n.useState([]),[f,u]=n.useState(!0),[g,k]=n.useState(1),[p,b]=n.useState(1),[I,w]=n.useState(""),[Q,x]=n.useState(""),[z,q]=n.useState(""),[E,Z]=n.useState(""),[Y,J]=n.useState(!1),[X,H]=n.useState(!1),[P,v]=n.useState(null),[S,B]=n.useState(null),[D,o]=n.useState(!1),[d,N]=n.useState(null),[V,U]=n.useState([]),[ee,te]=n.useState(!1),[_,G]=n.useState([]),[W,ie]=n.useState([]),[m,O]=n.useState({title:"",subtitle:"",category:void 0,status:"planning",display_page:void 0,location:"",base_address:"",year:new Date().getFullYear(),area:"",floor_plan_info:"",unit_count:0,display_order:0,is_featured:!1,facebook_page:"",booking_phone:"",info_website:"",description:"",detail_content:"",custom_fields:[],tags:[]});n.useEffect(()=>{const s={page:Number(a.get("page"))||1,search:a.get("search")||void 0,category:a.get("category")||void 0,status:a.get("status")||void 0,display_page:a.get("display_page")||void 0,is_featured:a.get("is_featured")==="true"?!0:void 0};b(s.page||1),w(s.search||""),x(s.category||""),q(s.status||""),Z(s.display_page||""),J(s.is_featured||!1),Ne(s)},[a]);const Ne=async s=>{try{u(!0);const h=await T.getProjects({...s,limit:10,orderBy:"created_at",orderDir:"DESC"});h.success&&h.data&&(l(h.data.items),k(h.data.pagination.pages))}catch(h){R.error("無法載入專案列表"),console.error("Projects fetch error:",h)}finally{u(!1)}},de=s=>{const h=new URLSearchParams,c={page:p,search:I,category:Q,status:z,display_page:E,is_featured:Y,...s};Object.entries(c).forEach(([C,se])=>{se&&se!==""&&h.set(C,String(se))}),t(h)},at=s=>{s.preventDefault(),de({search:I,page:1})},rt=async s=>{var h;s.preventDefault();try{let c;if(P)if((await T.updateProject(P.uuid,m)).success)c=P.uuid,R.success("專案已更新");else throw new Error("更新失敗");else{const C=await T.createProject(m);if(C.success&&C.data)c=C.data.project.uuid,R.success("專案已建立");else throw new Error("建立失敗")}if(W.length>0&&c)try{const C=W.map(me=>me.file),se=W.findIndex(me=>me.isMain),ue=await T.uploadImages(c,C,"gallery");if(ue.success&&((h=ue.data)!=null&&h.uploaded)){const me=ue.data.uploaded,He=se>=0?se:0;me[He]&&await T.setMainImage(c,me[He].id)}else throw new Error("圖片上傳失敗")}catch(C){console.error("Image upload error:",C),R.error("圖片上傳失敗，但專案已建立")}H(!1),ie([]),Ne({page:P?p:1})}catch{R.error(P?"更新專案失敗":"建立專案失敗")}},nt=async s=>{var h,c;try{v(s),G(s.images||[]);const C=await T.getProject(s.uuid);C.success&&((h=C.data)!=null&&h.project.images)&&G(C.data.project.images)}catch(C){console.error("Failed to fetch project details:",C),G(s.images||[])}O({title:s.title,subtitle:s.subtitle||"",category:s.category,status:s.status,display_page:s.display_page,location:s.location,base_address:s.base_address||"",year:s.year||new Date().getFullYear(),area:s.area||"",floor_plan_info:s.floor_plan_info||"",unit_count:s.unit_count||0,display_order:s.display_order,is_featured:s.is_featured,facebook_page:s.facebook_page||"",booking_phone:s.booking_phone||"",info_website:s.info_website||"",description:s.description||"",detail_content:s.detail_content||"",meta_title:s.meta_title||"",meta_description:s.meta_description||"",custom_fields:s.custom_fields||[],tags:((c=s.tags)==null?void 0:c.map(C=>typeof C=="string"?C:C.name))||[]}),H(!0)},it=async s=>{if(S!==s){B(s);return}try{const h=r.find(c=>c.id===s);h&&(await T.deleteProject(h.uuid),R.success("專案已刪除"),Ne({page:p}))}catch{R.error("刪除專案失敗")}finally{B(null)}},lt=async s=>{try{await T.toggleProjectFeatured(s.uuid),R.success(s.is_featured?"已取消精選":"已設為精選"),Ne({page:p})}catch{R.error("操作失敗")}},ot=()=>{v(null),G([]),ie([]),O({title:"",subtitle:"",category:void 0,status:"planning",display_page:void 0,location:"",base_address:"",year:new Date().getFullYear(),area:"",floor_plan_info:"",unit_count:0,display_order:0,is_featured:!1,facebook_page:"",booking_phone:"",info_website:"",description:"",detail_content:"",custom_fields:[],tags:[]}),H(!0)};return f&&r.length===0?e.jsx("div",{className:"flex justify-center items-center min-h-[60vh]",children:e.jsx(Le,{size:"large"})}):e.jsxs("div",{children:[e.jsxs("div",{className:"sm:flex sm:items-center sm:justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"專案管理"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"管理所有建案專案資訊"})]}),e.jsxs("button",{onClick:ot,className:"mt-4 sm:mt-0 inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",children:[e.jsx(ze,{className:"h-5 w-5 mr-2"}),"新增專案"]})]}),e.jsx("div",{className:"bg-white shadow rounded-lg p-6 mb-6",children:e.jsxs("form",{onSubmit:at,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"search",className:"block text-content-mobile lg:text-content-desktop font-medium text-gray-700 mb-1 tracking-wider",children:"搜尋專案"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-[2px] bg-primary-more"}),e.jsx("input",{type:"text",id:"search",value:I,onChange:s=>w(s.target.value),className:"w-full h-12 !pr-12 !pl-6 bg-gray-100 border-0 text-content-mobile lg:text-content-desktop focus:ring-0 focus:outline-none",placeholder:"輸入專案名稱..."}),e.jsx("div",{className:"absolute inset-y-0 right-0 pr-4 flex items-center pointer-events-none",children:e.jsx(ft,{className:"h-5 w-5 text-primary-more"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"display_page",className:"block text-content-mobile lg:text-content-desktop font-medium text-gray-700 mb-1 tracking-wider",children:"上架頁面"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-[2px] bg-primary-more"}),e.jsxs("select",{id:"display_page",value:E,onChange:s=>{Z(s.target.value),de({display_page:s.target.value,page:1})},className:"w-full h-12 !pr-4 !pl-6 bg-gray-100 border-0 text-content-mobile lg:text-content-desktop focus:ring-0 focus:outline-none appearance-none",children:[e.jsx("option",{value:"",children:"全部頁面"}),e.jsx("option",{value:"開發專區",children:"開發專區"}),e.jsx("option",{value:"澤暘作品",children:"澤暘作品"})]}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-4 pointer-events-none",children:e.jsx("svg",{className:"w-5 h-5 text-primary-more",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})]}),e.jsx("div",{className:"flex items-center",children:e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"checkbox",checked:Y,onChange:s=>{J(s.target.checked),de({is_featured:s.target.checked,page:1})},className:"rounded border-gray-300 text-primary-600 shadow-sm focus:border-primary-300 focus:ring focus:ring-primary-200 focus:ring-opacity-50"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"僅顯示精選"})]})})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"submit",className:"bg-primary-more text-white px-16 py-4 text-content-mobile lg:text-content-desktop font-medium tracking-wider hover:bg-opacity-90 transition-colors",children:"搜尋"})})]})}),e.jsxs("div",{className:"bg-white shadow overflow-hidden sm:rounded-md",children:[e.jsx("ul",{className:"divide-y divide-gray-200",children:r.map(s=>e.jsx("li",{children:e.jsx("div",{className:"px-4 py-4 sm:px-6 hover:bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[s.image_count&&s.main_image?e.jsx("div",{className:"h-12 w-12 bg-gray-200 rounded mr-4",children:e.jsx("img",{src:Pe(s.main_image.file_path),alt:"主圖",className:"w-full aspect-square object-scale-down rounded-lg"})}):e.jsx(_e,{className:"h-12 w-12 text-gray-400 mr-4"}),e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center",children:e.jsx("p",{className:"text-sm font-medium text-primary-600 truncate",children:s.title})}),e.jsxs("div",{className:"mt-1 flex items-center text-sm text-gray-500",children:[e.jsx("span",{className:"truncate",children:s.location}),e.jsx("span",{className:"mx-2",children:"•"}),e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-800",children:s.display_page})]}),e.jsxs("div",{className:"mt-1 flex items-center text-sm text-gray-500",children:[e.jsx(wt,{className:"h-4 w-4 mr-1"}),s.view_count," 瀏覽",e.jsx("span",{className:"mx-2",children:"•"}),e.jsxs("span",{children:["建立於 ",new Date(s.created_at).toLocaleDateString()]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>lt(s),className:ke("p-2 rounded-md transition-colors",s.is_featured?"text-yellow-600 hover:bg-yellow-50":"text-gray-400 hover:bg-gray-100"),title:s.is_featured?"取消精選":"設為精選",children:e.jsx(Se,{className:"h-5 w-5"})}),e.jsx("button",{onClick:async()=>{var h;N(s),o(!0),te(!0);try{const c=await T.getProject(s.uuid);c.success&&((h=c.data)!=null&&h.project.images)?U(c.data.project.images):U([])}catch(c){console.error("Failed to fetch project images:",c),R.error("載入圖片失敗，顯示快取圖片"),U(s.images||[])}finally{te(!1)}},className:"p-2 text-gray-400 hover:text-gray-500 hover:bg-gray-100 rounded-md",title:"管理圖片",children:e.jsx(_e,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>nt(s),className:"p-2 text-gray-400 hover:text-gray-500 hover:bg-gray-100 rounded-md",title:"編輯",children:e.jsx(Bt,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>it(s.id),className:ke("p-2 rounded-md transition-colors",S===s.id?"text-red-600 hover:bg-red-50":"text-gray-400 hover:text-gray-500 hover:bg-gray-100"),title:S===s.id?"確認刪除":"刪除",children:e.jsx(pe,{className:"h-5 w-5"})})]})]})})},s.id))}),r.length===0&&!f&&e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500",children:"沒有找到符合條件的專案"})})]}),g>1&&e.jsxs("div",{className:"mt-6 flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 flex justify-between sm:hidden",children:[e.jsx("button",{onClick:()=>de({page:p-1}),disabled:p===1,className:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"上一頁"}),e.jsx("button",{onClick:()=>de({page:p+1}),disabled:p===g,className:"ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"下一頁"})]}),e.jsx("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-center",children:e.jsx("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px","aria-label":"Pagination",children:Array.from({length:g},(s,h)=>h+1).map(s=>e.jsx("button",{onClick:()=>de({page:s}),className:ke("relative inline-flex items-center px-4 py-2 border text-sm font-medium",s===p?"z-10 bg-primary-50 border-primary-500 text-primary-600":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50"),children:s},s))})})]}),e.jsxs(he,{open:X,onClose:()=>{W.forEach(s=>URL.revokeObjectURL(s.preview)),ie([]),H(!1)},className:"relative z-50",children:[e.jsx("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:e.jsx(he.Panel,{className:"mx-auto max-w-2xl w-full bg-white rounded-lg shadow-xl",style:{maxHeight:"75dvh"},children:e.jsxs("div",{className:"p-6 overflow-y-auto",style:{maxHeight:"calc(75dvh - 2rem)"},children:[e.jsx(he.Title,{className:"text-lg font-medium text-gray-900 mb-4",children:P?"編輯專案":"新增專案"}),e.jsxs("form",{onSubmit:rt,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{htmlFor:"title",className:"block text-content-mobile lg:text-content-desktop font-medium text-gray-700 mb-1 tracking-wider",children:"專案名稱 *"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-[2px] bg-primary-more"}),e.jsx("input",{type:"text",id:"title",required:!0,value:m.title,onChange:s=>O({...m,title:s.target.value}),className:"w-full h-12 !pr-4 !pl-6 bg-gray-100 border-0 text-content-mobile lg:text-content-desktop focus:ring-0 focus:outline-none"})]})]}),m.display_page!=="開發專區"&&e.jsxs("div",{className:"!hidden sm:col-span-2",children:[e.jsx("label",{htmlFor:"subtitle",className:"block text-content-mobile lg:text-content-desktop font-medium text-gray-700 mb-1 tracking-wider",children:"副標題"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-[2px] bg-primary-我more"}),e.jsx("input",{type:"text",id:"subtitle",value:m.subtitle,onChange:s=>O({...m,subtitle:s.target.value}),className:"w-full h-12 !pr-4 !pl-6 bg-gray-100 border-0 text-content-mobile lg:text-content-desktop focus:ring-0 focus:outline-none"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"display_page",className:"block text-content-mobile lg:text-content-desktop font-medium text-gray-700 mb-1 tracking-wider",children:"上架頁面 *"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-[2px] bg-primary-more"}),e.jsxs("select",{id:"display_page",required:!0,value:m.display_page||"",onChange:s=>{const h=s.target.value,c={...m,display_page:h};h==="開發專區"&&(c.subtitle="",c.base_address="",c.year=new Date().getFullYear(),c.area="",c.floor_plan_info="",c.unit_count=0,c.description="",c.facebook_page="",c.booking_phone="",c.info_website="",c.custom_fields=[],c.is_featured=!1),O(c)},className:"w-full h-12 !pr-4 !pl-6 bg-gray-100 border-0 text-content-mobile lg:text-content-desktop focus:ring-0 focus:outline-none appearance-none",children:[e.jsx("option",{value:"",children:"選擇上架頁面"}),e.jsx("option",{value:"開發專區",children:"開發專區"}),e.jsx("option",{value:"澤暘作品",children:"澤暘作品"})]}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-4 pointer-events-none",children:e.jsx("svg",{className:"w-5 h-5 text-primary-more",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"location",className:"block text-content-mobile lg:text-content-desktop font-medium text-gray-700 mb-1 tracking-wider",children:"地區位置 *"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-[2px] bg-primary-more"}),e.jsx("input",{type:"text",id:"location",required:!0,value:m.location,onChange:s=>O({...m,location:s.target.value}),className:"w-full h-12 !pr-4 !pl-6 bg-gray-100 border-0 text-content-mobile lg:text-content-desktop focus:ring-0 focus:outline-none"})]})]}),m.display_page!=="開發專區"&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"base_address",className:"block text-content-mobile lg:text-content-desktop font-medium text-gray-700 mb-1 tracking-wider",children:"基地地址"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-[2px] bg-primary-more"}),e.jsx("input",{type:"text",id:"base_address",value:m.base_address,onChange:s=>O({...m,base_address:s.target.value}),className:"w-full h-12 !pr-4 !pl-6 bg-gray-100 border-0 text-content-mobile lg:text-content-desktop focus:ring-0 focus:outline-none"})]})]}),m.display_page!=="開發專區"&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"year",className:"block text-content-mobile lg:text-content-desktop font-medium text-gray-700 mb-1 tracking-wider",children:"年份"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-[2px] bg-primary-more"}),e.jsx("input",{type:"number",id:"year",value:m.year,onChange:s=>O({...m,year:parseInt(s.target.value)}),className:"w-full h-12 !pr-4 !pl-6 bg-gray-100 border-0 text-content-mobile lg:text-content-desktop focus:ring-0 focus:outline-none"})]})]}),m.display_page!=="開發專區"&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"area",className:"block text-content-mobile lg:text-content-desktop font-medium text-gray-700 mb-1 tracking-wider",children:"面積"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-[2px] bg-primary-more"}),e.jsx("input",{type:"text",id:"area",value:m.area,onChange:s=>O({...m,area:s.target.value}),className:"w-full h-12 !pr-4 !pl-6 bg-gray-100 border-0 text-content-mobile lg:text-content-desktop focus:ring-0 focus:outline-none"})]})]}),m.display_page!=="開發專區"&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"floor_plan_info",className:"block text-content-mobile lg:text-content-desktop font-medium text-gray-700 mb-1 tracking-wider",children:"樓層規劃"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-[2px] bg-primary-more"}),e.jsx("input",{type:"text",id:"floor_plan_info",value:m.floor_plan_info,onChange:s=>O({...m,floor_plan_info:s.target.value}),className:"w-full h-12 !pr-4 !pl-6 bg-gray-100 border-0 text-content-mobile lg:text-content-desktop focus:ring-0 focus:outline-none",placeholder:"例：地上15層/地下3層"})]})]}),m.display_page!=="開發專區"&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"unit_count",className:"block text-content-mobile lg:text-content-desktop font-medium text-gray-700 mb-1 tracking-wider",children:"戶數"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-[2px] bg-primary-more"}),e.jsx("input",{type:"number",id:"unit_count",min:"0",value:m.unit_count||"",onChange:s=>{const h=s.target.value;let c=0;h&&(c=Math.max(0,parseInt(h)||0)),O({...m,unit_count:c})},className:"w-full h-12 !pr-4 !pl-6 bg-gray-100 border-0 text-content-mobile lg:text-content-desktop focus:ring-0 focus:outline-none"})]})]}),m.display_page!=="開發專區"&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"facebook_page",className:"block text-content-mobile lg:text-content-desktop font-medium text-gray-700 mb-1 tracking-wider",children:"Facebook粉絲團"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-[2px] bg-primary-more"}),e.jsx("input",{type:"url",id:"facebook_page",value:m.facebook_page,onChange:s=>O({...m,facebook_page:s.target.value}),className:"w-full h-12 !pr-4 !pl-6 bg-gray-100 border-0 text-content-mobile lg:text-content-desktop focus:ring-0 focus:outline-none",placeholder:"https://facebook.com/..."})]})]}),m.display_page!=="開發專區"&&e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{htmlFor:"booking_phone",className:"block text-content-mobile lg:text-content-desktop font-medium text-gray-700 mb-1 tracking-wider",children:"預約專線"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-[2px] bg-primary-more"}),e.jsx("input",{type:"tel",id:"booking_phone",value:m.booking_phone,onChange:s=>O({...m,booking_phone:s.target.value}),className:"w-full h-12 !pr-4 !pl-6 bg-gray-100 border-0 text-content-mobile lg:text-content-desktop focus:ring-0 focus:outline-none",placeholder:"02-1234-5678"})]})]}),m.display_page!=="開發專區"&&e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{htmlFor:"info_website",className:"block text-content-mobile lg:text-content-desktop font-medium text-gray-700 mb-1 tracking-wider",children:"介紹網站"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-[2px] bg-primary-more"}),e.jsx("input",{type:"url",id:"info_website",value:m.info_website,onChange:s=>O({...m,info_website:s.target.value}),className:"w-full h-12 !pr-4 !pl-6 bg-gray-100 border-0 text-content-mobile lg:text-content-desktop focus:ring-0 focus:outline-none",placeholder:"https://..."})]})]}),m.display_page!=="開發專區"&&e.jsxs("div",{className:"!hidden sm:col-span-2",children:[e.jsx("label",{htmlFor:"description",className:"block text-content-mobile lg:text-content-desktop font-medium text-gray-700 mb-1 tracking-wider",children:"描述"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-[2px] bg-primary-more"}),e.jsx("textarea",{id:"description",rows:3,value:m.description,onChange:s=>O({...m,description:s.target.value}),className:"w-full px-4 py-3 pl-6 bg-gray-100 border-0 text-content-mobile lg:text-content-desktop focus:ring-0 focus:outline-none resize-none"})]})]}),e.jsxs("div",{className:"!hidden sm:col-span-2",children:[e.jsx("label",{htmlFor:"tags",className:"block text-content-mobile lg:text-content-desktop font-medium text-gray-700 mb-1 tracking-wider",children:"標籤"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-[2px] bg-primary-more"}),e.jsx("div",{className:"pl-6",children:e.jsx(Kt,{value:m.tags||[],onChange:s=>O({...m,tags:s}),placeholder:"輸入標籤名稱或選擇現有標籤"})})]}),e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"可以新增多個標籤，按 Enter 確認輸入"})]}),m.display_page!=="開發專區"&&e.jsx("div",{className:"sm:col-span-2",children:e.jsx(Zt,{fields:m.custom_fields??[],onChange:s=>O({...m,custom_fields:s}),label:"自訂欄位"})}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"專案圖片"}),e.jsx("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx(st,{className:"mx-auto h-10 w-10 text-gray-400"}),e.jsxs("div",{className:"mt-3",children:[e.jsxs("label",{htmlFor:"unified-image-upload",className:"cursor-pointer",children:[e.jsx("span",{className:"inline-flex items-center px-3 py-1.5 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700",children:"選擇圖片"}),e.jsx("input",{id:"unified-image-upload",type:"file",className:"sr-only",multiple:!0,accept:"image/*",onChange:s=>{if(s.target.files){const h=Array.from(s.target.files),c=((_==null?void 0:_.length)||0)+W.length;if(c+h.length>20){R.error("最多只能上傳 20 張圖片");return}const C=h.map((se,ue)=>({id:`local-${Date.now()}-${ue}`,file:se,preview:URL.createObjectURL(se),isMain:c===0&&ue===0}));ie([...W,...C])}}})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"或拖放圖片到此處"}),e.jsx("p",{className:"text-xs text-gray-400",children:"支援 JPG、PNG、GIF、WebP，最多 20 張"})]})]})}),(_&&_.length>0||W.length>0)&&e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("p",{className:"text-sm font-medium text-gray-700",children:["已選擇 ",((_==null?void 0:_.length)||0)+W.length," 張圖片"]})}),e.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[_&&_.map(s=>e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:`aspect-square border-2 rounded-lg overflow-hidden ${s.image_type==="main"?"border-primary-line":"border-gray-200"}`,children:e.jsx("img",{src:Pe(s.file_path),alt:s.alt_text||"",className:"w-full h-full object-scale-down"})}),s.image_type==="main"&&e.jsx("div",{className:"absolute top-1 left-1",children:e.jsx(Ce,{className:"h-5 w-5 text-primary-line"})}),e.jsxs("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-40 transition-opacity rounded-lg flex items-center justify-center opacity-0 group-hover:opacity-100",children:[s.image_type!=="main"&&P&&e.jsx("button",{type:"button",onClick:async()=>{try{await T.setMainImage(P.uuid,s.id);const h=_.map(c=>({...c,image_type:c.id===s.id?"main":c.image_type==="main"?"gallery":c.image_type}));G(h),R.success("已設為主圖")}catch{R.error("設定主圖失敗")}},className:"p-1.5 bg-white rounded-full text-gray-700 hover:bg-gray-100 mr-1",title:"設為主圖",children:e.jsx(Se,{className:"h-4 w-4"})}),P&&e.jsx("button",{type:"button",onClick:async()=>{try{await T.deleteImage(P.uuid,s.id),G(_.filter(h=>h.id!==s.id)),R.success("圖片已刪除")}catch{R.error("刪除圖片失敗")}},className:"p-1.5 bg-white rounded-full text-red-600 hover:bg-red-50",title:"刪除",children:e.jsx(pe,{className:"h-4 w-4"})})]})]},`existing-${s.id}`)),W.map((s,h)=>e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:`aspect-square border-2 rounded-lg overflow-hidden ${s.isMain?"border-primary-line":"border-gray-200"}`,children:e.jsx("img",{src:s.preview,alt:`新圖片 ${h+1}`,className:"w-full h-full object-scale-down"})}),s.isMain&&e.jsx("div",{className:"absolute top-1 left-1",children:e.jsx(Ce,{className:"h-5 w-5 text-primary-line"})}),e.jsxs("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-40 transition-opacity rounded-lg flex items-center justify-center opacity-0 group-hover:opacity-100",children:[!s.isMain&&e.jsx("button",{type:"button",onClick:()=>{const c=W.map(C=>({...C,isMain:C.id===s.id}));ie(c)},className:"p-1.5 bg-white rounded-full text-gray-700 hover:bg-gray-100 mr-1",title:"設為主圖",children:e.jsx(Se,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:()=>{URL.revokeObjectURL(s.preview);const c=W.filter(C=>C.id!==s.id);s.isMain&&c.length>0&&(c[0].isMain=!0),ie(c)},className:"p-1.5 bg-white rounded-full text-red-600 hover:bg-red-50",title:"刪除",children:e.jsx(pe,{className:"h-4 w-4"})})]})]},`new-${s.id}`))]})]}),(!_||_.length===0)&&W.length===0&&e.jsxs("div",{className:"text-center py-4",children:[e.jsx(_e,{className:"mx-auto h-10 w-10 text-gray-400"}),e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"尚未選擇任何圖片"})]})]}),e.jsx("div",{className:"sm:col-span-2",children:e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"checkbox",checked:m.is_featured,disabled:m.display_page==="開發專區",onChange:s=>O({...m,is_featured:s.target.checked}),className:"rounded border-gray-300 text-primary-600 shadow-sm focus:border-primary-300 focus:ring focus:ring-primary-200 focus:ring-opacity-50 disabled:opacity-50 disabled:cursor-not-allowed"}),e.jsxs("span",{className:`ml-2 text-sm ${m.display_page==="開發專區"?"text-gray-400":"text-gray-700"}`,children:["設為精選專案",m.display_page==="開發專區"&&e.jsx("span",{className:"text-xs block text-gray-400",children:"開發專區不可設為精選"})]})]})})]}),e.jsxs("div",{className:"mt-6 flex justify-center space-x-4",children:[e.jsx("button",{type:"button",onClick:()=>{W.forEach(s=>URL.revokeObjectURL(s.preview)),ie([]),H(!1)},className:"bg-gray-500 text-white px-16 py-4 text-content-mobile lg:text-content-desktop font-medium tracking-wider hover:bg-opacity-90 transition-colors",children:"取消"}),e.jsx("button",{type:"submit",className:"bg-primary-more text-white px-16 py-4 text-content-mobile lg:text-content-desktop font-medium tracking-wider hover:bg-opacity-90 transition-colors",children:P?"更新":"建立"})]})]})]})})})]}),e.jsxs(he,{open:D,onClose:()=>{o(!1),te(!1),N(null),U([])},className:"relative z-50",children:[e.jsx("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:e.jsx(he.Panel,{className:"mx-auto max-w-4xl w-full bg-white rounded-lg shadow-xl",style:{maxHeight:"75dvh"},children:e.jsxs("div",{className:"p-6 overflow-y-auto",style:{maxHeight:"calc(75dvh - 2rem)"},children:[e.jsxs(he.Title,{className:"text-lg font-medium text-gray-900 mb-4",children:[d==null?void 0:d.title," - 圖片管理"]}),ee?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(Le,{size:"medium"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"載入圖片中..."})]}):e.jsx(Gt,{projectUuid:d==null?void 0:d.uuid,images:V,onImagesChange:s=>{if(U(s),d){const h=r.map(c=>c.id===d.id?{...c,images:s,image_count:s.length}:c);l(h)}},maxFiles:20}),e.jsx("div",{className:"mt-6 flex justify-center",children:e.jsx("button",{type:"button",onClick:()=>{o(!1),te(!1),N(null),U([])},className:"bg-gray-500 text-white px-16 py-4 text-content-mobile lg:text-content-desktop font-medium tracking-wider hover:bg-opacity-90 transition-colors",children:"關閉"})})]})})})]})]})};export{ns as default};
//# sourceMappingURL=index-B0YpoF0t.js.map
