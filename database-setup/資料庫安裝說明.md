# 澤暘建設網站 - 資料庫安裝說明

## 📋 系統需求
- **MySQL 版本**: 8.0 或更高版本
- **字符集**: UTF8MB4
- **排序規則**: utf8mb4_unicode_ci

## 🚀 快速安裝步驟

### 步驟 1: 建立資料庫
```sql
CREATE DATABASE zeyang CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

### 步驟 2: 匯入資料表結構
使用提供的 `schema.sql` 檔案：

**方法 A - 使用 phpMyAdmin（虛擬主機常用）**
1. 登入 phpMyAdmin
2. 選擇或建立 `zeyang` 資料庫
3. 點擊「匯入」標籤
4. 選擇 `schema.sql` 檔案
5. 點擊「執行」

**方法 B - 使用命令列**
```bash
mysql -u 您的使用者名稱 -p zeyang < schema.sql
```

### 步驟 3: 建立預設管理員帳號
執行以下 SQL 語句建立管理員帳號：
```sql
USE zeyang;

-- 建立預設管理員（密碼: admin123456）
INSERT INTO users (username, email, password, role, is_active) 
VALUES (
    'admin',
    'admin@zeyanggroup.com.tw',
    '$2b$10$YourHashedPasswordHere',
    'admin',
    1
);
```

**注意**: 實際密碼雜湊值需要使用 bcrypt 加密，預設密碼為 `admin123456`

### 步驟 4: 設定環境變數
請在後端應用程式設定以下環境變數：

```env
# 資料庫連線設定
DB_HOST=localhost           # 資料庫主機
DB_PORT=3306                # 資料庫連接埠
DB_NAME=zeyang              # 資料庫名稱
DB_USER=您的資料庫使用者     # 資料庫使用者名稱
DB_PASSWORD=您的資料庫密碼   # 資料庫密碼

# JWT 認證設定（請更改為安全的密鑰）
JWT_SECRET=your-super-secure-jwt-secret-2024
JWT_EXPIRES_IN=24h
REFRESH_SECRET=your-super-secure-refresh-secret-2024
REFRESH_EXPIRES_IN=7d
```

## 📊 資料表說明

### 1. **users** - 使用者資料表
- 儲存系統管理員和使用者帳號
- 支援多種角色權限（admin, editor, viewer）

### 2. **projects** - 專案資料表
- 儲存建案專案資訊
- 支援中英文雙語內容
- 包含價格、面積、開發商等詳細資訊

### 3. **project_images** - 專案圖片資料表
- 儲存專案相關圖片
- 支援多張圖片排序
- 區分主要圖片和次要圖片

### 4. **tags** - 標籤資料表
- 專案分類標籤
- 支援中英文雙語

### 5. **project_tags** - 專案標籤關聯表
- 管理專案與標籤的多對多關係

### 6. **contacts** - 聯絡表單資料表
- 儲存網站訪客的聯絡資訊
- 包含處理狀態追蹤

### 7. **settings** - 系統設定資料表
- 儲存網站全域設定
- 支援 JSON 格式的設定值

## 🔐 安全建議

1. **更改預設密碼**
   - 首次登入後立即更改管理員密碼
   - 使用強密碼（至少 12 個字符）

2. **資料庫權限**
   - 建立專用的資料庫使用者
   - 只授予必要的權限（SELECT, INSERT, UPDATE, DELETE）
   - 避免使用 root 帳號

3. **定期備份**
   - 設定每日自動備份
   - 保留至少 7 天的備份檔案

## 🛠️ 故障排除

### 問題 1: 字符集錯誤
如果出現中文亂碼，請確認：
```sql
-- 檢查資料庫字符集
SHOW VARIABLES LIKE 'character_set%';
-- 應該顯示 utf8mb4

-- 修正資料庫字符集
ALTER DATABASE zeyang CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

### 問題 2: 連線失敗
檢查項目：
1. 資料庫服務是否運行
2. 使用者名稱和密碼是否正確
3. 資料庫名稱是否正確
4. 防火牆是否允許 3306 端口

### 問題 3: 權限不足
```sql
-- 授予使用者權限
GRANT ALL PRIVILEGES ON zeyang.* TO '使用者名稱'@'localhost';
FLUSH PRIVILEGES;
```

## 📞 需要協助？

如有任何問題，請提供以下資訊：
1. MySQL 版本號
2. 錯誤訊息截圖
3. 執行的 SQL 語句

---
**文件版本**: 1.0.0  
**更新日期**: 2025-08-22